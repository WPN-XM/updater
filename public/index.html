<!DOCTYPE html>
<html lang="en" dir="ltr" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WPN-XM Software Registry - Update Tool</title>
    <meta name="description" content="WPN-XM Software Registry Update Tool" />
    <meta name="author" content="Jens-Andre Koch" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'/>
    <link href="public/assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="public/assets/css/style.css" rel="stylesheet"/>
    <link rel="shortcut icon" href="public/assets/ico/favicon.ico"/>
  </head>

  <body>

    <nav class="navbar navbar-dark bg-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">WPN-XM Updater</a>          
        </div>   
        <ul class="nav navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" style="margin-top: 2px">Maintainance and Update Tool for WPN-XM Software Registries</a>           
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="index.php" style="margin-top: 2px">Home</a>
          </li>
        </ul>       
      </div><!--/.nav-collapse -->
    </nav>

    <div id="main" class="container-fluid">

    <table class="table" style="width: 1400px;">
    <thead>
        <th></th>
        <th>Data &amp; Metadata Files</th>
        <th>Actions</th>
    </thead>
    <tr>
      <td><strong>Version Crawler</strong></td>
      <td></td>
      <td>
        <a href="http://localhost/updater/index.php?action=scan-component" class="btn btn-secondary btn-sm" data-toggle="tooltip" 
                 title="Do a version crawl for all components.">Scan for new Versions</a>
        <a href="http://localhost/updater/index.php?action=scan-component" class="btn btn-danger btn-sm" data-toggle="tooltip"
                 title="Do a version crawl for a single component.">Scan Single Component</a>
      </td>
    </tr>
    <tr>
    <tr>
      <td><strong>Installer Registries</strong></td>
      <td>
          <a href="https://github.com/WPN-XM/registry/tree/master/installer/next" data-toggle="tooltip"
                     title="Go to the folder with the installer registries of the next, but unreleased version."
                     class="btn btn-secondary btn-sm">Unreleased Installers</a>
          <a href="https://github.com/WPN-XM/registry/tree/master/installer" data-toggle="tooltip"
                     title="Go to the folder with released installer registries."
                     class="btn btn-secondary btn-sm">Released Installers</a>        
      </td>
      <td>
          <a href="http://localhost/updater/index.php?action=update-components" class="btn btn-secondary btn-sm" data-toggle="tooltip"
                   title="Automatically raise the version of each Component to its latest version in all installer registries of the next, but unreleased version.">
                   Update Versions</a>
          <a href="http://localhost/updater/index.php?action=show-version-matrix" class="btn btn-secondary btn-sm" data-toggle="tooltip"
             title="Full overview of all components and versions included in all installers.">
             Version Matrix</a>  
          <a href="http://localhost/updater/index.php?action=compare-installers" class="btn btn-danger btn-sm" data-toggle="tooltip"
             title="Compare two installer registries.">
             Compare Installers</a>             
          <a href="http://localhost/updater/index.php?action=pretty-print-registries" class="btn btn-secondary btn-sm" data-toggle="tooltip"
             title="This enables you to prettify the registries after a manual modification.">
             Pretty Print Registries</a>

      </td>
    </tr>
    <tr>
      <td><strong>Stack Software Registry</strong></td>
      <td>
          <a href="https://github.com/WPN-XM/registry/blob/master/wpnxm-software-registry.php" 
             class="btn btn-secondary btn-sm">wpnxm-software-registry.php</a>
      </td>
      <td>     
          <a href="http://localhost/updater/index.php?action=add-component" class="btn btn-danger btn-sm">Add Software</a>
          <a href="http://localhost/updater/index.php?action=edit-component" class="btn btn-danger btn-sm">Edit Software</a>
          <a href="http://localhost/updater/index.php?action=registry-health-check" class="btn btn-secondary btn-sm">Lint (schema)</a> 
        <br>
          <a href="http://localhost/updater/index.php?action=link-status" class="btn btn-secondary btn-sm">Check Links - All</a>
          <a href="http://localhost/updater/index.php?action=link-status-component" class="btn btn-danger btn-sm">Check Links - Single Component</a>          
      </td>
    </tr>
    <tr>
      <td><strong>PHP Software Registry</strong></td>
      <td><a href="https://github.com/WPN-XM/registry/blob/master/wpnxm-php-software-registry.php" class="btn btn-secondary btn-sm">wpnxm-php-software-registry.php</a></td>
      <td><a href="http://localhost/updater/index.php?action=add-component" class="btn btn-danger btn-sm" title="Add PHP Software">Add</a>
              <a href="" class="btn btn-danger btn-sm" title="Edit PHP Software">Edit</a>
              <a href="" class="btn btn-danger btn-sm" title="Lint: Check schema and structure of the registry.">Lint (schema)</a></td>
    </tr>
    <tr>
      <td><strong>Software Metadata Registry</strong></td>
      <td><a href="https://github.com/WPN-XM/registry/blob/master/wpnxm-registry-metadata.php" class="btn btn-secondary btn-sm">wpnxm-registry-metadata.php</a></td>
      <td><a href="" class="btn btn-danger btn-sm" data-toggle="tooltip"
                 title="Lint: Check schema and structure of the registry and synchronization state with the software registry.">Lint (schema) (sync)</a></td>
    </tr>
    <tr>
      <td><strong>PHP Extensions</strong></td>
      <td>
      <a href="https://github.com/WPN-XM/registry/blob/master/php-extensions-on-pecl.json" class="btn btn-secondary btn-sm">php-extensions-on-pecl.json</a>
      <a href="https://github.com/WPN-XM/registry/blob/master/php-extensions-outside-pecl.json" class="btn btn-secondary btn-sm">php-extensions-outside-pecl.json</a>
      </td>
      <td>
        <a href="http://localhost/updater/index.php?action=update-phpextension-list" class="btn btn-secondary btn-sm" data-toggle="tooltip"
               title="Scan PECL (https://pecl.php.net/) for new PHP Extensions.">Update PHP Extension List</a>         
      </td>
    </tr>
    </table>

    <div class="row row-offcanvas row-offcanvas-left">
        <div class="col-xs-12 col-sm-8">
            <div id="ajax-container">
              <!-- This is where the precious Ajax Content goes... -->
            </div> <!-- /ajax-container -->  
        </div><!-- /content -->
    </div>
     
    <!-- The modal windows with Ajax Loading Indicator - hidden, but loaded with the main page / top-level position -->
    <div id="myModal" class="modal bootstrap-dialog type-primary size-normal fade in"
         tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">

          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
              <span class="sr-only">Close</span>
            </button>
            <h4 class="modal-title">Please wait...</h4>
          </div>
          <div class="modal-body center">
            <p><img src='public/assets/img/ajax_spinner.gif' alt="Loading... Please wait." /></p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>

        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!-- javascript -->
    <script src="public/assets/js/jquery.min.js"></script>
    <script src="public/assets/js/tether.min.js"></script><!-- tooltip lib -->
    <script src="public/assets/js/bootstrap.min.js"></script>    
    <script type="text/javascript">
      $(document).ready(function () {

          // enable tooltips
          $('[data-toggle="tooltip"]').tooltip();

          // we need to rebind, when we pull in new modal content
          function bindModalSubmitButton() {
            // bind "submit" button on the modal window
            $('#myModal button[type="submit"]').on("click", function (event) {
                var form = $("#myModal .modal-body form");

                $.ajax({
                    type: form.attr('method'),
                    url: form.attr('action'),
                    data: form.serializeArray(),
                    cache: false,
                    async: true,
                    success: function (response) {
                        $('#myModal .modal-body').html(response);
                    }
                });

                event.preventDefault();
            });
          }
          bindModalSubmitButton();

          // with a click on a link on main div, do the following
          $("#main a").on("click", function (event) {
                event.preventDefault(); // stop the click from causing navigation
                href = $(this).attr('href'); // get click target href
                doGetRequest(href);
                //doGetRequestIfServerIsRunning(href);
                return false; // stop clicking from causing navigation
          });

          // test, if script on the server is available with a timeout request
          // if the timeout is not reached, we assume the server is running and do the "non-timeout" call to href
          function doGetRequestIfServerIsRunning(href) {
              $.ajax({
                  url: "index.php",
                  type: "HEAD",
                  timeout: 500, // set timeout to 0,5 sec
                  cache: false,
                  async: true,
                  statusCode: {
                      200: function (response) {
                          doGetRequest(href);
                      },
                      400: function (response) {
                          alert("Request Timeout!\n\nEnsure Server & PHP are up!");
                      },
                      0: function (response) {
                          alert("Request Timeout!\n\nEnsure Server & PHP are up!");
                      }
                  }
              });
          }

          function doGetRequest(href) {
              // reset target, show modal dlg
              $("#ajax-container").empty();
              $('#myModal').modal('show');

              // ajax call to the PHP scripts
              $.ajax({
                  url: href,
                  cache: false,
                  timeout: 99999,
                  async: true
              }).done(function (html) {
                  // fetch content into modal
                  if(href === "index.php?action=add-component") {
                    $('#myModal .modal-content').empty().append(html);
                    bindModalSubmitButton();
                  } else {
                    // hide modal, insert content on target
                    $('#myModal').modal('hide');
                    $("#ajax-container").empty().append(html);

                    // enable tooltips on all incoming elements with "data-rel" property set to "tooltip"
                    $('[data-rel=tooltip]').tooltip();
                  }
              });

              return;
          }
      }); // document.read end
    </script>
  </body>
</html>
